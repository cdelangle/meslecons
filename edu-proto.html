<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MesLeÃ§ons âœ¦</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f0e17;
    --surface: #1a1928;
    --card: #222136;
    --border: rgba(255,255,255,0.07);
    --accent-matheo: #f7b731;
    --accent-ethan: #26de81;
    --accent-romane: #fd79a8;
    --accent-default: #a29bfe;
    --text: #fffffe;
    --text-dim: #a7a9be;
    --radius: 18px;
    --accent: #a29bfe;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ Stars background â”€â”€ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,0.3) 0%, transparent 100%),
      radial-gradient(1px 1px at 80% 10%, rgba(255,255,255,0.2) 0%, transparent 100%),
      radial-gradient(1px 1px at 50% 80%, rgba(255,255,255,0.25) 0%, transparent 100%),
      radial-gradient(1px 1px at 10% 60%, rgba(255,255,255,0.15) 0%, transparent 100%),
      radial-gradient(1px 1px at 90% 70%, rgba(255,255,255,0.2) 0%, transparent 100%),
      radial-gradient(2px 2px at 35% 15%, rgba(255,255,255,0.1) 0%, transparent 100%),
      radial-gradient(1px 1px at 65% 50%, rgba(255,255,255,0.2) 0%, transparent 100%);
    pointer-events: none;
    z-index: 0;
  }

  /* â”€â”€ SCREENS â”€â”€ */
  .screen { display: none; position: relative; z-index: 1; }
  .screen.active { display: block; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: API KEY
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-apikey {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  .apikey-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 3rem;
    max-width: 480px;
    width: 100%;
    text-align: center;
    box-shadow: 0 30px 80px rgba(0,0,0,0.5);
  }

  .apikey-box .logo {
    font-family: 'Baloo 2', sans-serif;
    font-size: 2.5rem;
    font-weight: 800;
    background: linear-gradient(135deg, #a29bfe, #fd79a8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 0.5rem;
  }

  .apikey-box p {
    color: var(--text-dim);
    font-size: 0.95rem;
    margin-bottom: 2rem;
    line-height: 1.6;
  }

  .apikey-box a { color: var(--accent); }

  .field-group { text-align: left; margin-bottom: 1.2rem; }
  .field-group label { display: block; font-size: 0.85rem; color: var(--text-dim); margin-bottom: 0.4rem; font-weight: 600; letter-spacing: 0.04em; }

  input[type="text"], input[type="password"], input[type="number"], select, textarea {
    width: 100%;
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    padding: 0.75rem 1rem;
    outline: none;
    transition: border-color 0.2s;
  }

  input:focus, select:focus, textarea:focus { border-color: var(--accent); }
  textarea { resize: vertical; min-height: 100px; }

  select option { background: var(--surface); }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.8rem 2rem;
    border-radius: 12px;
    border: none;
    font-family: 'Baloo 2', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s, opacity 0.2s;
    text-decoration: none;
  }

  .btn:hover { transform: translateY(-2px); }
  .btn:active { transform: translateY(0); }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .btn-primary {
    background: linear-gradient(135deg, #a29bfe, #6c5ce7);
    color: white;
    box-shadow: 0 4px 20px rgba(108,92,231,0.4);
    width: 100%;
  }

  .btn-outline {
    background: transparent;
    border: 1.5px solid var(--border);
    color: var(--text-dim);
  }

  .btn-outline:hover { border-color: var(--accent); color: var(--text); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: WHO ARE YOU?
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-who {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    gap: 2rem;
  }

  .who-title {
    font-family: 'Baloo 2', sans-serif;
    font-size: 2rem;
    font-weight: 800;
    text-align: center;
  }

  .who-title span {
    background: linear-gradient(135deg, #a29bfe, #fd79a8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .profiles-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    justify-content: center;
    max-width: 700px;
  }

  .profile-card {
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: 20px;
    padding: 2rem 1.5rem;
    width: 160px;
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
  }

  .profile-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 16px 40px rgba(0,0,0,0.4);
  }

  .profile-card.matheo { --pc: var(--accent-matheo); }
  .profile-card.ethan  { --pc: var(--accent-ethan); }
  .profile-card.romane { --pc: var(--accent-romane); }
  .profile-card.parent { --pc: var(--accent-default); }

  .profile-card:hover { border-color: var(--pc); box-shadow: 0 16px 40px rgba(0,0,0,0.4), 0 0 0 1px var(--pc); }

  .profile-avatar {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    margin: 0 auto 1rem;
    background: color-mix(in srgb, var(--pc) 15%, transparent);
    border: 2px solid color-mix(in srgb, var(--pc) 40%, transparent);
  }

  .profile-name {
    font-family: 'Baloo 2', sans-serif;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text);
  }

  .profile-level {
    font-size: 0.8rem;
    color: var(--text-dim);
    margin-top: 0.25rem;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: CHILD HOME
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-child {
    min-height: 100vh;
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
  }

  .child-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2.5rem;
  }

  .child-greeting {
    font-family: 'Baloo 2', sans-serif;
    font-size: 1.6rem;
    font-weight: 800;
  }

  .child-greeting .hi { color: var(--text-dim); font-weight: 400; font-size: 1rem; display: block; }

  .session-score {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 0.6rem 1.2rem;
    font-size: 0.9rem;
    color: var(--text-dim);
  }

  .session-score strong { color: var(--text); font-family: 'Baloo 2', sans-serif; }

  .section-title {
    font-family: 'Baloo 2', sans-serif;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-dim);
    letter-spacing: 0.05em;
    text-transform: uppercase;
    font-size: 0.8rem;
    margin-bottom: 1rem;
  }

  /* Subject pills */
  .subjects-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 2.5rem;
  }

  .subject-pill {
    padding: 0.6rem 1.2rem;
    border-radius: 50px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .subject-pill:hover, .subject-pill.selected {
    border-color: var(--current-accent);
    background: color-mix(in srgb, var(--current-accent) 15%, transparent);
    color: var(--current-accent);
  }

  /* Photo upload zone */
  .upload-zone {
    border: 2px dashed var(--border);
    border-radius: var(--radius);
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 2rem;
    background: var(--surface);
  }

  .upload-zone:hover {
    border-color: var(--current-accent);
    background: color-mix(in srgb, var(--current-accent) 8%, transparent);
  }

  .upload-zone.has-image { border-style: solid; }

  .upload-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
  .upload-zone p { color: var(--text-dim); font-size: 0.9rem; }
  .upload-preview { max-width: 100%; max-height: 200px; border-radius: 10px; margin-top: 1rem; }

  /* Free prompt */
  .free-prompt-area {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .free-prompt-area label { display: block; font-weight: 600; margin-bottom: 0.75rem; }
  .free-prompt-area .hint { font-size: 0.8rem; color: var(--text-dim); margin-top: 0.5rem; }

  .generate-btn {
    background: linear-gradient(135deg, var(--current-accent, #a29bfe), color-mix(in srgb, var(--current-accent, #a29bfe) 70%, #000));
    color: white;
    width: 100%;
    padding: 1rem;
    font-size: 1.1rem;
    border-radius: 14px;
    border: none;
    font-family: 'Baloo 2', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.2s, opacity 0.2s;
    box-shadow: 0 4px 24px rgba(0,0,0,0.3);
  }

  .generate-btn:hover { transform: translateY(-2px); }
  .generate-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: EXERCISE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-exercise {
    min-height: 100vh;
    max-width: 720px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
  }

  .exercise-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .exercise-progress {
    flex: 1;
    height: 8px;
    background: var(--surface);
    border-radius: 99px;
    overflow: hidden;
  }

  .exercise-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--current-accent, #a29bfe), color-mix(in srgb, var(--current-accent, #a29bfe) 60%, #fff));
    border-radius: 99px;
    transition: width 0.4s ease;
  }

  .exercise-counter {
    font-size: 0.85rem;
    color: var(--text-dim);
    white-space: nowrap;
    font-weight: 600;
  }

  .question-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .question-subject-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 0.3rem 0.8rem;
    border-radius: 50px;
    background: color-mix(in srgb, var(--current-accent, #a29bfe) 15%, transparent);
    color: var(--current-accent, #a29bfe);
    margin-bottom: 1rem;
  }

  .question-text {
    font-size: 1.15rem;
    line-height: 1.7;
    margin-bottom: 1.5rem;
  }

  .answer-area textarea {
    width: 100%;
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    font-size: 1rem;
    padding: 1rem;
    resize: none;
    min-height: 80px;
    outline: none;
    transition: border-color 0.2s;
  }

  .answer-area textarea:focus { border-color: var(--current-accent, #a29bfe); }

  /* MCQ options */
  .options-list { display: flex; flex-direction: column; gap: 0.75rem; }

  .option-btn {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.2rem;
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    font-size: 1rem;
  }

  .option-btn:hover:not(:disabled) {
    border-color: var(--current-accent, #a29bfe);
    background: color-mix(in srgb, var(--current-accent, #a29bfe) 10%, transparent);
  }

  .option-letter {
    width: 30px;
    height: 30px;
    min-width: 30px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Baloo 2', sans-serif;
    font-weight: 700;
    font-size: 0.85rem;
    background: var(--surface);
    color: var(--text-dim);
    transition: all 0.2s;
  }

  .option-btn.correct { border-color: #26de81; background: rgba(38,222,129,0.1); }
  .option-btn.correct .option-letter { background: #26de81; color: #000; }
  .option-btn.wrong { border-color: #ff6b6b; background: rgba(255,107,107,0.1); }
  .option-btn.wrong .option-letter { background: #ff6b6b; color: #fff; }
  .option-btn:disabled { cursor: not-allowed; }

  /* Feedback */
  .feedback-box {
    border-radius: 14px;
    padding: 1.2rem 1.5rem;
    margin-top: 1rem;
    font-size: 0.95rem;
    line-height: 1.6;
    display: none;
  }

  .feedback-box.show { display: block; animation: slideUp 0.3s ease; }
  .feedback-box.correct { background: rgba(38,222,129,0.1); border: 1px solid rgba(38,222,129,0.3); }
  .feedback-box.wrong { background: rgba(255,107,107,0.1); border: 1px solid rgba(255,107,107,0.3); }

  .feedback-box .emoji { font-size: 1.4rem; margin-bottom: 0.3rem; display: block; }

  .action-row {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
  }

  .btn-validate {
    flex: 1;
    padding: 0.9rem;
    background: linear-gradient(135deg, var(--current-accent, #a29bfe), color-mix(in srgb, var(--current-accent, #a29bfe) 70%, #000));
    color: white;
    border: none;
    border-radius: 12px;
    font-family: 'Baloo 2', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-validate:hover { transform: translateY(-2px); }
  .btn-validate:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  .btn-next {
    flex: 1;
    padding: 0.9rem;
    background: var(--surface);
    color: var(--text);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    font-family: 'Baloo 2', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    display: none;
  }

  .btn-next.show { display: block; }
  .btn-next:hover { border-color: var(--accent); color: var(--text); }

  /* Loading */
  .loading-overlay {
    position: fixed;
    inset: 0;
    background: rgba(15,14,23,0.85);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 100;
    flex-direction: column;
    gap: 1rem;
  }

  .loading-overlay.show { display: flex; }

  .spinner {
    width: 48px;
    height: 48px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-text {
    font-family: 'Baloo 2', sans-serif;
    font-size: 1.1rem;
    color: var(--text-dim);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: RESULTS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-results {
    min-height: 100vh;
    max-width: 720px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
    text-align: center;
  }

  .results-emoji { font-size: 5rem; margin-bottom: 1rem; display: block; }

  .results-title {
    font-family: 'Baloo 2', sans-serif;
    font-size: 2.2rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
  }

  .results-score {
    font-size: 4rem;
    font-family: 'Baloo 2', sans-serif;
    font-weight: 800;
    background: linear-gradient(135deg, var(--current-accent, #a29bfe), #fd79a8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 1rem 0;
  }

  .results-list {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 1.5rem;
    text-align: left;
    margin: 2rem 0;
  }

  .result-item {
    padding: 1rem 0;
    border-bottom: 1px solid var(--border);
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 0.75rem;
    align-items: start;
  }

  .result-item:last-child { border-bottom: none; }

  .result-icon { font-size: 1.2rem; margin-top: 2px; }

  .result-q { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 0.25rem; }
  .result-answer { font-size: 0.9rem; }
  .result-correct-ans { font-size: 0.85rem; color: #26de81; margin-top: 0.2rem; }

  .results-actions { display: flex; gap: 1rem; flex-wrap: wrap; }
  .results-actions .btn { flex: 1; min-width: 140px; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: PARENT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-parent {
    min-height: 100vh;
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
  }

  .parent-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2.5rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .parent-title {
    font-family: 'Baloo 2', sans-serif;
    font-size: 1.8rem;
    font-weight: 800;
  }

  .child-tabs {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 2rem;
  }

  .child-tab {
    padding: 0.5rem 1.2rem;
    border-radius: 50px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    cursor: pointer;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.2s;
    color: var(--text-dim);
  }

  .child-tab.active {
    border-color: var(--tab-color);
    background: color-mix(in srgb, var(--tab-color) 15%, transparent);
    color: var(--tab-color);
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 1.2rem 1.5rem;
  }

  .stat-value {
    font-family: 'Baloo 2', sans-serif;
    font-size: 2rem;
    font-weight: 800;
    color: var(--current-accent, #a29bfe);
  }

  .stat-label { font-size: 0.8rem; color: var(--text-dim); font-weight: 600; margin-top: 0.2rem; }

  .history-list { display: flex; flex-direction: column; gap: 1rem; }

  .history-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 1.2rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .history-badge {
    font-size: 1.5rem;
    min-width: 40px;
    text-align: center;
  }

  .history-info { flex: 1; }
  .history-q { font-size: 0.9rem; margin-bottom: 0.2rem; }
  .history-meta { font-size: 0.8rem; color: var(--text-dim); }
  .history-score-badge {
    padding: 0.3rem 0.8rem;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 700;
    font-family: 'Baloo 2', sans-serif;
  }

  .score-great { background: rgba(38,222,129,0.15); color: #26de81; }
  .score-ok { background: rgba(247,183,49,0.15); color: #f7b731; }
  .score-low { background: rgba(255,107,107,0.15); color: #ff6b6b; }

  .empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--text-dim);
  }

  .empty-state .icon { font-size: 3rem; margin-bottom: 1rem; }

  /* nav */
  .back-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    color: var(--text-dim);
    font-size: 0.9rem;
    cursor: pointer;
    padding: 0.4rem 0;
    border: none;
    background: none;
    font-family: 'Nunito', sans-serif;
    transition: color 0.2s;
  }
  .back-btn:hover { color: var(--text); }

  /* â”€â”€ Accent per child â”€â”€ */
  .accent-matheo { --current-accent: #f7b731; }
  .accent-ethan  { --current-accent: #26de81; }
  .accent-romane { --current-accent: #fd79a8; }
  .accent-parent { --current-accent: #a29bfe; }

  /* scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 99px; }
</style>
</head>
<body>

<!-- LOADING -->
<div class="loading-overlay" id="loading">
  <div class="spinner"></div>
  <div class="loading-text" id="loading-text">L'IA prÃ©pare tes exercicesâ€¦</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN: API KEY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-apikey" class="screen active">
  <div class="apikey-box">
    <div class="logo">MesLeÃ§ons âœ¦</div>
    <p>Pour commencer, entre ta clÃ© API Anthropic.<br>
    Tu peux en crÃ©er une sur <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> (compte gratuit).</p>
    <div class="field-group">
      <label>CLÃ‰ API</label>
      <input type="password" id="api-key-input" placeholder="sk-ant-..." autocomplete="off">
    </div>
    <button class="btn btn-primary" onclick="saveApiKey()">Commencer â†’</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN: WHO â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-who" class="screen">
  <div class="who-title">Bonjour ! <br>Tu es <span>qui ?</span></div>
  <div class="profiles-grid">
    <div class="profile-card matheo" onclick="selectProfile('matheo')">
      <div class="profile-avatar">ğŸš€</div>
      <div class="profile-name">MathÃ©o</div>
      <div class="profile-level">4Ã¨me</div>
    </div>
    <div class="profile-card ethan" onclick="selectProfile('ethan')">
      <div class="profile-avatar">âš¡</div>
      <div class="profile-name">Ethan</div>
      <div class="profile-level">CM1</div>
    </div>
    <div class="profile-card romane" onclick="selectProfile('romane')">
      <div class="profile-avatar">ğŸŒ¸</div>
      <div class="profile-name">Romane</div>
      <div class="profile-level">CM1</div>
    </div>
    <div class="profile-card parent" onclick="selectProfile('parent')">
      <div class="profile-avatar">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</div>
      <div class="profile-name">Parent</div>
      <div class="profile-level">Tableau de bord</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN: CHILD HOME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-child" class="screen">
  <div class="child-header">
    <div>
      <span class="hi" id="child-hi">Salut</span>
      <div class="child-greeting" id="child-greeting">MathÃ©o ğŸš€</div>
    </div>
    <div class="session-score">Session : <strong id="session-score-display">0 / 0</strong></div>
  </div>

  <div class="section-title">Choisir une matiÃ¨re</div>
  <div class="subjects-grid" id="subjects-grid"></div>

  <div class="upload-zone" id="upload-zone" onclick="document.getElementById('photo-input').click()">
    <div class="upload-icon">ğŸ“¸</div>
    <p>Clique pour envoyer une photo de ton cours ou exercice<br><small>L'IA crÃ©era des questions basÃ©es dessus !</small></p>
    <img id="upload-preview" class="upload-preview" style="display:none">
    <input type="file" id="photo-input" accept="image/*" style="display:none" onchange="handlePhoto(event)">
  </div>

  <div class="free-prompt-area">
    <label>ğŸ’¬ Demande libre Ã  l'IA</label>
    <textarea id="free-prompt" placeholder="Ex : Fais-moi 5 questions sur les fractions, ou des exercices de conjugaison au passÃ© composÃ©â€¦"></textarea>
    <div class="hint">Laisse vide pour que l'IA choisisse selon la matiÃ¨re sÃ©lectionnÃ©e.</div>
  </div>

  <button class="generate-btn" id="generate-btn" onclick="generateExercises()">
    âœ¨ GÃ©nÃ©rer les exercices
  </button>
  <div style="margin-top:1rem; text-align:center;">
    <button class="back-btn" onclick="goWho()">â† Changer de profil</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN: EXERCISE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-exercise" class="screen">
  <div class="exercise-header">
    <button class="back-btn" onclick="goChild()">â† Retour</button>
    <div class="exercise-progress"><div class="exercise-progress-bar" id="progress-bar"></div></div>
    <div class="exercise-counter" id="exercise-counter">1/5</div>
  </div>

  <div class="question-card" id="question-card">
    <div class="question-subject-badge" id="q-badge">Maths</div>
    <div class="question-text" id="q-text">Chargementâ€¦</div>
    <div class="answer-area" id="answer-area"></div>
    <div class="feedback-box" id="feedback-box"></div>
    <div class="action-row">
      <button class="btn-validate" id="btn-validate" onclick="validateAnswer()">Valider âœ“</button>
      <button class="btn-next" id="btn-next" onclick="nextQuestion()">Suivant â†’</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN: RESULTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-results" class="screen">
  <span class="results-emoji" id="results-emoji">ğŸ†</span>
  <div class="results-title" id="results-title">Bravo !</div>
  <div class="results-score" id="results-score">8/10</div>
  <p id="results-msg" style="color:var(--text-dim); margin-bottom:1rem;"></p>

  <div class="results-list" id="results-list"></div>

  <div class="results-actions">
    <button class="btn btn-outline" onclick="goChild()">Nouvel exercice</button>
    <button class="btn btn-primary" onclick="goWho()">Changer de profil</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN: PARENT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-parent" class="screen">
  <div class="parent-header">
    <div class="parent-title">ğŸ“Š Tableau de bord</div>
    <button class="back-btn" onclick="goWho()">â† Retour</button>
  </div>

  <div class="child-tabs" id="parent-tabs"></div>

  <div id="parent-content"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PROFILES = {
  matheo: { name: 'MathÃ©o', level: '4Ã¨me (collÃ¨ge)', emoji: 'ğŸš€', accent: 'accent-matheo', color: '#f7b731' },
  ethan:  { name: 'Ethan',  level: 'CM1 (primaire)', emoji: 'âš¡', accent: 'accent-ethan',  color: '#26de81' },
  romane: { name: 'Romane', level: 'CM1 (primaire)', emoji: 'ğŸŒ¸', accent: 'accent-romane', color: '#fd79a8' },
};

const SUBJECTS = [
  { id: 'maths',    label: 'Maths',      icon: 'ğŸ”¢' },
  { id: 'francais', label: 'FranÃ§ais',   icon: 'ğŸ“' },
  { id: 'histoire', label: 'Histoire',   icon: 'ğŸ›ï¸' },
  { id: 'geo',      label: 'GÃ©ographie', icon: 'ğŸŒ' },
  { id: 'sciences', label: 'Sciences',   icon: 'ğŸ”¬' },
  { id: 'anglais',  label: 'Anglais',    icon: 'ğŸ‡¬ğŸ‡§' },
  { id: 'surprise', label: 'Surprise !', icon: 'ğŸ²' },
];

let state = {
  apiKey: '',
  currentProfile: null,
  selectedSubject: null,
  photoBase64: null,
  photoMime: null,
  questions: [],
  currentQ: 0,
  sessionCorrect: 0,
  sessionTotal: 0,
  answers: [],   // {question, userAnswer, correct, correctAnswer}
  history: {},   // { matheo: [], ethan: [], romane: [] }
  parentActiveChild: 'matheo',
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCREEN NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + id).classList.add('active');
}

function setAccent(profileKey) {
  const screens = document.querySelectorAll('.screen');
  screens.forEach(s => {
    s.classList.remove('accent-matheo','accent-ethan','accent-romane','accent-parent');
    if (profileKey) s.classList.add('accent-' + profileKey);
  });
}

function saveApiKey() {
  const k = document.getElementById('api-key-input').value.trim();
  if (!k.startsWith('sk-ant-')) {
    alert('La clÃ© doit commencer par sk-ant-');
    return;
  }
  state.apiKey = k;
  showScreen('who');
}

function goWho() { showScreen('who'); setAccent(null); }

function selectProfile(p) {
  if (p === 'parent') {
    state.currentProfile = 'parent';
    setAccent('parent');
    renderParent();
    showScreen('parent');
    return;
  }
  state.currentProfile = p;
  setAccent(p);
  state.selectedSubject = null;
  state.photoBase64 = null;
  state.photoMime = null;
  document.getElementById('free-prompt').value = '';
  document.getElementById('upload-preview').style.display = 'none';
  document.getElementById('upload-zone').classList.remove('has-image');

  const prof = PROFILES[p];
  document.getElementById('child-greeting').textContent = prof.name + ' ' + prof.emoji;
  document.getElementById('session-score-display').textContent = state.sessionCorrect + ' / ' + state.sessionTotal;

  renderSubjects();
  showScreen('child');
}

function goChild() {
  state.currentQ = 0;
  state.answers = [];
  showScreen('child');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHILD HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSubjects() {
  const grid = document.getElementById('subjects-grid');
  grid.innerHTML = '';
  SUBJECTS.forEach(s => {
    const pill = document.createElement('button');
    pill.className = 'subject-pill' + (state.selectedSubject === s.id ? ' selected' : '');
    pill.innerHTML = s.icon + ' ' + s.label;
    pill.onclick = () => {
      state.selectedSubject = s.id;
      renderSubjects();
    };
    grid.appendChild(pill);
  });
}

function handlePhoto(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    const data = ev.target.result;
    state.photoMime = file.type;
    state.photoBase64 = data.split(',')[1];
    const preview = document.getElementById('upload-preview');
    preview.src = data;
    preview.style.display = 'block';
    document.getElementById('upload-zone').classList.add('has-image');
  };
  reader.readAsDataURL(file);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GENERATE EXERCISES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function generateExercises() {
  const prof = PROFILES[state.currentProfile];
  const freePrompt = document.getElementById('free-prompt').value.trim();

  let subjectInfo = '';
  if (state.selectedSubject && state.selectedSubject !== 'surprise') {
    const s = SUBJECTS.find(x => x.id === state.selectedSubject);
    subjectInfo = s ? s.label : '';
  }

  showLoading('L\'IA prÃ©pare tes exercicesâ€¦');

  try {
    const systemPrompt = `Tu es un assistant pÃ©dagogique bienveillant et motivant.
Tu crÃ©es des exercices adaptÃ©s au niveau scolaire exact de l'Ã©lÃ¨ve.
Tu rÃ©ponds UNIQUEMENT en JSON valide, sans texte avant ni aprÃ¨s.

Format de rÃ©ponse :
{
  "exercises": [
    {
      "type": "mcq" | "open",
      "subject": "Nom de la matiÃ¨re",
      "question": "La question",
      "options": ["A","B","C","D"],  // seulement pour mcq
      "correctIndex": 0,             // seulement pour mcq (0-3)
      "correctAnswer": "rÃ©ponse",    // pour open
      "explanation": "Explication courte et encourageante"
    }
  ]
}

RÃ¨gles :
- GÃ©nÃ¨re exactement 5 exercices
- Mix de MCQ et questions ouvertes (prÃ©fÃ¨re MCQ pour enfants primaire)
- Adapte prÃ©cisÃ©ment au niveau : ${prof.level}
- Questions claires, encourageantes, variÃ©es
- Pour CM1 : questions simples, concrÃ¨tes
- Pour 4Ã¨me : questions plus complexes, abstraites
- Explications courtes (1-2 phrases), positives mÃªme en cas d'erreur`;

    let userContent = [];

    if (state.photoBase64) {
      userContent.push({
        type: 'image',
        source: { type: 'base64', media_type: state.photoMime, data: state.photoBase64 }
      });
      userContent.push({
        type: 'text',
        text: `Voici une photo du cours/exercice de ${prof.name} (niveau ${prof.level}). CrÃ©e 5 exercices basÃ©s sur ce contenu.${freePrompt ? ' Instructions supplÃ©mentaires : ' + freePrompt : ''}`
      });
    } else {
      let prompt = `CrÃ©e 5 exercices pour ${prof.name}, Ã©lÃ¨ve en ${prof.level}.`;
      if (subjectInfo) prompt += ` MatiÃ¨re : ${subjectInfo}.`;
      if (freePrompt) prompt += ` Demande spÃ©cifique : ${freePrompt}.`;
      if (!subjectInfo && !freePrompt) prompt += ` Choisis une matiÃ¨re adaptÃ©e et variÃ©e.`;
      userContent.push({ type: 'text', text: prompt });
    }

    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': state.apiKey,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-direct-browser-access': 'true'
      },
      body: JSON.stringify({
        model: 'claude-opus-4-6',
        max_tokens: 2000,
        system: systemPrompt,
        messages: [{ role: 'user', content: userContent }]
      })
    });

    if (!response.ok) {
      const err = await response.json();
      throw new Error(err.error?.message || 'Erreur API');
    }

    const data = await response.json();
    const raw = data.content[0].text.trim();
    const parsed = JSON.parse(raw);
    state.questions = parsed.exercises;
    state.currentQ = 0;
    state.answers = [];

    hideLoading();
    renderQuestion();
    showScreen('exercise');

  } catch (err) {
    hideLoading();
    alert('Erreur : ' + err.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXERCISE SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderQuestion() {
  const q = state.questions[state.currentQ];
  const total = state.questions.length;

  document.getElementById('exercise-counter').textContent = (state.currentQ + 1) + '/' + total;
  document.getElementById('progress-bar').style.width = ((state.currentQ + 1) / total * 100) + '%';
  document.getElementById('q-badge').textContent = q.subject;
  document.getElementById('q-text').textContent = q.question;

  const feedbackBox = document.getElementById('feedback-box');
  feedbackBox.className = 'feedback-box';
  feedbackBox.innerHTML = '';

  const btnValidate = document.getElementById('btn-validate');
  const btnNext = document.getElementById('btn-next');
  btnValidate.style.display = 'inline-flex';
  btnValidate.disabled = false;
  btnNext.className = 'btn-next';

  const area = document.getElementById('answer-area');
  area.innerHTML = '';

  if (q.type === 'mcq') {
    const list = document.createElement('div');
    list.className = 'options-list';
    const letters = ['A','B','C','D'];
    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className = 'option-btn';
      btn.dataset.index = i;
      btn.innerHTML = `<span class="option-letter">${letters[i]}</span> ${opt}`;
      btn.onclick = () => selectOption(i);
      list.appendChild(btn);
    });
    area.appendChild(list);
    btnValidate.disabled = true;
  } else {
    const ta = document.createElement('textarea');
    ta.placeholder = 'Ta rÃ©ponseâ€¦';
    ta.id = 'open-answer';
    ta.oninput = () => { btnValidate.disabled = ta.value.trim().length === 0; };
    area.appendChild(ta);
    btnValidate.disabled = true;
  }
}

let selectedOptionIndex = null;

function selectOption(i) {
  selectedOptionIndex = i;
  document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected-option'));
  const btn = document.querySelector(`.option-btn[data-index="${i}"]`);
  if (btn) {
    btn.style.borderColor = 'var(--current-accent)';
    btn.style.background = 'color-mix(in srgb, var(--current-accent) 12%, transparent)';
  }
  document.getElementById('btn-validate').disabled = false;
}

async function validateAnswer() {
  const q = state.questions[state.currentQ];
  const feedbackBox = document.getElementById('feedback-box');
  const btnValidate = document.getElementById('btn-validate');
  const btnNext = document.getElementById('btn-next');
  btnValidate.disabled = true;

  let isCorrect = false;
  let userAnswerText = '';

  if (q.type === 'mcq') {
    const idx = selectedOptionIndex;
    isCorrect = idx === q.correctIndex;
    userAnswerText = q.options[idx];

    document.querySelectorAll('.option-btn').forEach(b => {
      b.disabled = true;
      b.style.borderColor = '';
      b.style.background = '';
    });

    const correctBtn = document.querySelector(`.option-btn[data-index="${q.correctIndex}"]`);
    if (correctBtn) correctBtn.classList.add('correct');
    if (!isCorrect && idx !== null) {
      const wrongBtn = document.querySelector(`.option-btn[data-index="${idx}"]`);
      if (wrongBtn) wrongBtn.classList.add('wrong');
    }
  } else {
    const ta = document.getElementById('open-answer');
    userAnswerText = ta ? ta.value.trim() : '';
    ta && (ta.disabled = true);

    // Ask AI to evaluate open answer
    showLoading('Correction en coursâ€¦');
    try {
      const evalResp = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': state.apiKey,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify({
          model: 'claude-opus-4-6',
          max_tokens: 200,
          messages: [{
            role: 'user',
            content: `Question: "${q.question}"\nRÃ©ponse attendue: "${q.correctAnswer}"\nRÃ©ponse de l'Ã©lÃ¨ve: "${userAnswerText}"\n\nL'Ã©lÃ¨ve a-t-il raison ? RÃ©ponds UNIQUEMENT en JSON: {"correct": true/false}`
          }]
        })
      });
      const evalData = await evalResp.json();
      const evalText = evalData.content[0].text.trim();
      const evalJson = JSON.parse(evalText.replace(/```json|```/g, ''));
      isCorrect = evalJson.correct;
    } catch (e) {
      // Simple fallback
      isCorrect = userAnswerText.toLowerCase().trim() === (q.correctAnswer || '').toLowerCase().trim();
    }
    hideLoading();
  }

  if (isCorrect) state.sessionCorrect++;
  state.sessionTotal++;
  document.getElementById('session-score-display').textContent = state.sessionCorrect + ' / ' + state.sessionTotal;

  state.answers.push({
    question: q.question,
    userAnswer: userAnswerText,
    correct: isCorrect,
    correctAnswer: q.correctAnswer || (q.options && q.options[q.correctIndex]) || '',
    explanation: q.explanation
  });

  feedbackBox.className = 'feedback-box show ' + (isCorrect ? 'correct' : 'wrong');
  feedbackBox.innerHTML = `
    <span class="emoji">${isCorrect ? 'âœ…' : 'âŒ'}</span>
    <strong>${isCorrect ? 'Bravo !' : 'Pas tout Ã  faitâ€¦'}</strong><br>
    ${!isCorrect && q.type === 'mcq' ? `<span style="color:var(--text-dim)">RÃ©ponse correcte : <strong style="color:#26de81">${q.options[q.correctIndex]}</strong></span><br>` : ''}
    ${q.explanation}
  `;

  btnValidate.style.display = 'none';
  const isLast = state.currentQ === state.questions.length - 1;
  btnNext.className = 'btn-next show';
  btnNext.textContent = isLast ? 'Voir les rÃ©sultats â†’' : 'Question suivante â†’';

  selectedOptionIndex = null;
}

function nextQuestion() {
  if (state.currentQ < state.questions.length - 1) {
    state.currentQ++;
    renderQuestion();
  } else {
    showResults();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESULTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showResults() {
  const correct = state.answers.filter(a => a.correct).length;
  const total = state.answers.length;
  const pct = Math.round(correct / total * 100);
  const prof = PROFILES[state.currentProfile];

  // Save to history
  if (!state.history[state.currentProfile]) state.history[state.currentProfile] = [];
  state.history[state.currentProfile].push({
    date: new Date().toLocaleString('fr-FR'),
    score: correct,
    total,
    answers: [...state.answers]
  });

  let emoji = 'ğŸ˜…', title = 'Continue comme Ã§a !', msg = 'Tu peux encore progresser.';
  if (pct >= 80) { emoji = 'ğŸ†'; title = 'Excellent !'; msg = 'Tu maÃ®trises trÃ¨s bien !'; }
  else if (pct >= 60) { emoji = 'ğŸ‘'; title = 'Bien jouÃ© !'; msg = 'Encore un effort pour tout maÃ®triser.'; }
  else if (pct >= 40) { emoji = 'ğŸ’ª'; title = 'Bon courage !'; msg = 'Revois les points en rouge avec un adulte.'; }

  document.getElementById('results-emoji').textContent = emoji;
  document.getElementById('results-title').textContent = title;
  document.getElementById('results-score').textContent = correct + '/' + total;
  document.getElementById('results-msg').textContent = msg;

  const list = document.getElementById('results-list');
  list.innerHTML = '<div class="section-title" style="margin-bottom:1rem;">DÃ©tail des rÃ©ponses</div>';
  state.answers.forEach((a, i) => {
    const div = document.createElement('div');
    div.className = 'result-item';
    div.innerHTML = `
      <div class="result-icon">${a.correct ? 'âœ…' : 'âŒ'}</div>
      <div>
        <div class="result-q">Q${i+1} Â· ${a.question}</div>
        <div class="result-answer">Ta rÃ©ponse : <strong>${a.userAnswer || '(vide)'}</strong></div>
        ${!a.correct ? `<div class="result-correct-ans">âœ“ Bonne rÃ©ponse : ${a.correctAnswer}</div>` : ''}
      </div>
    `;
    list.appendChild(div);
  });

  showScreen('results');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARENT DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderParent() {
  const tabs = document.getElementById('parent-tabs');
  tabs.innerHTML = '';
  ['matheo','ethan','romane'].forEach(p => {
    const prof = PROFILES[p];
    const tab = document.createElement('button');
    tab.className = 'child-tab' + (state.parentActiveChild === p ? ' active' : '');
    tab.style.setProperty('--tab-color', prof.color);
    tab.textContent = prof.emoji + ' ' + prof.name;
    tab.onclick = () => { state.parentActiveChild = p; renderParent(); };
    tabs.appendChild(tab);
  });

  const child = state.parentActiveChild;
  const sessions = state.history[child] || [];
  const content = document.getElementById('parent-content');

  if (sessions.length === 0) {
    content.innerHTML = `<div class="empty-state"><div class="icon">ğŸ“­</div><p>${PROFILES[child].name} n'a pas encore fait d'exercices.</p></div>`;
    return;
  }

  const allAnswers = sessions.flatMap(s => s.answers);
  const totalQ = allAnswers.length;
  const correctQ = allAnswers.filter(a => a.correct).length;
  const avgPct = totalQ > 0 ? Math.round(correctQ / totalQ * 100) : 0;
  const errors = allAnswers.filter(a => !a.correct);

  content.innerHTML = `
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" style="color:${PROFILES[child].color}">${sessions.length}</div>
        <div class="stat-label">Sessions</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="color:${PROFILES[child].color}">${totalQ}</div>
        <div class="stat-label">Questions rÃ©pondues</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="color:${PROFILES[child].color}">${avgPct}%</div>
        <div class="stat-label">Taux de rÃ©ussite</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="color:#ff6b6b">${errors.length}</div>
        <div class="stat-label">Erreurs Ã  revoir</div>
      </div>
    </div>

    ${errors.length > 0 ? `
    <div class="section-title" style="margin-bottom:1rem; color:#ff6b6b">âš ï¸ Points Ã  retravailler</div>
    <div class="history-list" style="margin-bottom:2rem">
      ${errors.map(a => `
        <div class="history-item">
          <div class="history-badge">âŒ</div>
          <div class="history-info">
            <div class="history-q">${a.question}</div>
            <div class="history-meta">RÃ©ponse donnÃ©e : <em>${a.userAnswer || '(vide)'}</em> Â· Bonne rÃ©ponse : <strong style="color:#26de81">${a.correctAnswer}</strong></div>
          </div>
        </div>
      `).join('')}
    </div>` : ''}

    <div class="section-title" style="margin-bottom:1rem;">ğŸ“… Historique des sessions</div>
    <div class="history-list">
      ${sessions.slice().reverse().map((s, i) => {
        const pct = Math.round(s.score / s.total * 100);
        const cls = pct >= 80 ? 'score-great' : pct >= 50 ? 'score-ok' : 'score-low';
        return `
          <div class="history-item">
            <div class="history-badge">${pct >= 80 ? 'ğŸ†' : pct >= 50 ? 'ğŸ‘' : 'ğŸ’ª'}</div>
            <div class="history-info">
              <div class="history-q">${s.total} questions Â· ${s.date}</div>
            </div>
            <div class="history-score-badge ${cls}">${s.score}/${s.total}</div>
          </div>`;
      }).join('')}
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOADING HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showLoading(text) {
  document.getElementById('loading-text').textContent = text || 'Chargementâ€¦';
  document.getElementById('loading').classList.add('show');
}

function hideLoading() {
  document.getElementById('loading').classList.remove('show');
}
</script>
</body>
</html>
